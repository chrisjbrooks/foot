<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using custom summary functions in `foot` • foot</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using custom summary functions in `foot`">
<meta property="og:description" content="Building footprints or polygons representing the outline shape of structures can provide a unique data source for studying urban areas at high spatial resolutions. This vignette will demonstrate how to supply custom functions to the `foot` package to extend the range of potential summary metrics.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">foot</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/footsteps.html">footsteps: Getting started</a>
    </li>
    <li>
      <a href="../articles/bigfoot.html">bigfoot: Gridded footprint calculations</a>
    </li>
    <li>
      <a href="../articles/cobbler.html">cobbler: Using custom summary functions</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/wpgp/foot/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using custom summary functions in <code>foot</code>
</h1>
            
            <h4 class="date">October 21, 2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/wpgp/foot/blob/master/vignettes/cobbler.Rmd"><code>vignettes/cobbler.Rmd</code></a></small>
      <div class="hidden name"><code>cobbler.Rmd</code></div>

    </div>

    
    
<p>The <code>foot</code> package was developed by WorldPop at the University of Southampton (<a href="https://www.worldpop.org">www.worldpop.org</a>) to support geometric calculations and summaries of measures from building footprint polygons. This vignette demonstrates how users can extend the basic functionality of <code>calculate_footstats</code> and <code>calculate_bigfoot</code> by making and supplying their own functions to summarise footprint characteristics. For an introduction to the package, see <code><a href="../articles/footsteps.html">vignette("footsteps")</a></code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/wpgp/foot">foot</a></span><span class="op">)</span></pre></div>
<div id="calculations-with-foot" class="section level2">
<h2 class="hasAnchor">
<a href="#calculations-with-foot" class="anchor"></a>Calculations with <code>foot</code>
</h2>
<p>As noted in the introductory vignettes, <code>foot</code> primarily uses <code>calculate_footstats</code> to calculate and summarise metrics. Internally this function uses <code>data.table</code> in order to handle large sets of building footprints and efficiently summarise them. The attributes to be summarised (<code>what</code>) are supplied to function names (<code>how</code>). These internal structures also allow for user-defined functions to be specified.</p>
<div id="data-preparation" class="section level3">
<h3 class="hasAnchor">
<a href="#data-preparation" class="anchor"></a>Data preparation</h3>
<p>To demonstrate using custom functions, we will first add some additional attribute “data” to the footprints which we will use.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"kampala"</span>, package <span class="op">=</span> <span class="st">"foot"</span><span class="op">)</span>

<span class="va">buildings</span> <span class="op">&lt;-</span> <span class="va">kampala</span><span class="op">$</span><span class="va">buildings</span>
<span class="va">adminzones</span> <span class="op">&lt;-</span> <span class="va">kampala</span><span class="op">$</span><span class="va">adminZones</span>

<span class="co"># Adding random data categorical variable</span>
<span class="va">buildings</span><span class="op">$</span><span class="va">category</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">buildings</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="co"># continuous variable</span>
<span class="va">buildings</span><span class="op">$</span><span class="va">mult</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">buildings</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fl">10</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></pre></div>
<p>We can use any attributes of the footprints within <code>calculate_footstats</code> and <code>calculate_bigfoot</code>, not only the built-in morphology measures listed by <code><a href="../reference/list_fs.html">list_fs(what='all')</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="co"># summarising a new data value</span>
<span class="fu"><a href="../reference/calculate_footstats.html">calculate_footstats</a></span><span class="op">(</span><span class="va">buildings</span>,
                    <span class="va">adminzones</span>,
                    what<span class="op">=</span><span class="st">"mult"</span>, <span class="co"># new attribute to summarise</span>
                    how<span class="op">=</span><span class="st">"mean"</span>,
                    verbose<span class="op">=</span><span class="cn">F</span><span class="op">)</span>
<span class="co">#&gt;     zoneID mult_mean</span>
<span class="co">#&gt;  1:      1  9.666786</span>
<span class="co">#&gt;  2:      2  9.841946</span>
<span class="co">#&gt;  3:      3  9.817887</span>
<span class="co">#&gt;  4:      4  9.896108</span>
<span class="co">#&gt;  5:      5  9.585723</span>
<span class="co">#&gt;  6:      6 10.399327</span>
<span class="co">#&gt;  7:      7  9.822931</span>
<span class="co">#&gt;  8:      8  9.948185</span>
<span class="co">#&gt;  9:      9  9.839114</span>
<span class="co">#&gt; 10:     10  9.390817</span>
<span class="co">#&gt; 11:     11 10.084299</span>
<span class="co">#&gt; 12:     12  9.656353</span>
<span class="co">#&gt; 13:     13  9.065091</span>
<span class="co">#&gt; 14:     14  9.806507</span>
<span class="co">#&gt; 15:     15  9.826152</span>
<span class="co">#&gt; 16:     16 10.183840</span>
<span class="co">#&gt; 17:     17 10.153940</span>
<span class="co">#&gt; 18:     18  9.956768</span>
<span class="co">#&gt; 19:     19  9.881288</span>
<span class="co">#&gt; 20:     20 10.051673</span>
<span class="co">#&gt; 21:     21 10.196925</span>
<span class="co">#&gt; 22:     22  9.773030</span>
<span class="co">#&gt; 23:     23  9.867830</span>
<span class="co">#&gt; 24:     24  9.995201</span>
<span class="co">#&gt; 25:     25 10.134532</span>
<span class="co">#&gt; 26:     26 10.009279</span>
<span class="co">#&gt; 27:     27  9.989495</span>
<span class="co">#&gt; 28:     29  9.839616</span>
<span class="co">#&gt; 29:     30 10.492154</span>
<span class="co">#&gt; 30:     31 10.385578</span>
<span class="co">#&gt; 31:     32 10.004733</span>
<span class="co">#&gt; 32:     33  9.674933</span>
<span class="co">#&gt; 33:     34 10.031255</span>
<span class="co">#&gt;     zoneID mult_mean</span></pre></div>
</div>
<div id="additional-built-in-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#additional-built-in-functions" class="anchor"></a>Additional built-in functions</h3>
<p>The internal <code>foot</code> functions are documented in <code><a href="../reference/fs_functions.html">?fs_functions</a></code>; however, these functions are intended to be used within the wrapper functions of <code>foot</code> and are rarely intended to be used as standalone functions. One built-in summary function, not applied by default, is <code>majority</code>. It is designed to summarise categorical data. This function is available for users in the same manner of specifying the <code>how</code> argument.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="co"># get the majority category in each zone</span>
<span class="fu"><a href="../reference/calculate_footstats.html">calculate_footstats</a></span><span class="op">(</span><span class="va">buildings</span>, 
                    <span class="va">adminzones</span>, 
                    what<span class="op">=</span><span class="st">"category"</span>, 
                    how<span class="op">=</span><span class="st">"majority"</span>, 
                    verbose<span class="op">=</span><span class="cn">F</span><span class="op">)</span>
<span class="co">#&gt;     zoneID category_majority</span>
<span class="co">#&gt;  1:      1                 A</span>
<span class="co">#&gt;  2:      2                 B</span>
<span class="co">#&gt;  3:      3                 A</span>
<span class="co">#&gt;  4:      4                 A</span>
<span class="co">#&gt;  5:      5                 C</span>
<span class="co">#&gt;  6:      6                 C</span>
<span class="co">#&gt;  7:      7                 C</span>
<span class="co">#&gt;  8:      8                 A</span>
<span class="co">#&gt;  9:      9                 C</span>
<span class="co">#&gt; 10:     10                 D</span>
<span class="co">#&gt; 11:     11                 B</span>
<span class="co">#&gt; 12:     12                 C</span>
<span class="co">#&gt; 13:     13                 E</span>
<span class="co">#&gt; 14:     14                 A</span>
<span class="co">#&gt; 15:     15                 C</span>
<span class="co">#&gt; 16:     16                 B</span>
<span class="co">#&gt; 17:     17                 A</span>
<span class="co">#&gt; 18:     18                 D</span>
<span class="co">#&gt; 19:     19                 A</span>
<span class="co">#&gt; 20:     20                 D</span>
<span class="co">#&gt; 21:     21                 B</span>
<span class="co">#&gt; 22:     22                 A</span>
<span class="co">#&gt; 23:     23                 A</span>
<span class="co">#&gt; 24:     24                 B</span>
<span class="co">#&gt; 25:     25                 A</span>
<span class="co">#&gt; 26:     26                 C</span>
<span class="co">#&gt; 27:     27                 A</span>
<span class="co">#&gt; 28:     29                 E</span>
<span class="co">#&gt; 29:     30                 B</span>
<span class="co">#&gt; 30:     31                 B</span>
<span class="co">#&gt; 31:     32                 D</span>
<span class="co">#&gt; 32:     33                 B</span>
<span class="co">#&gt; 33:     34                 C</span>
<span class="co">#&gt;     zoneID category_majority</span></pre></div>
<p>The <code>majority</code> function is similar to the idea of supplying a user-defined function which is demonstrated in the next section.</p>
</div>
</div>
<div id="user-defined-summary-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#user-defined-summary-functions" class="anchor"></a>User-defined summary functions</h2>
<p>Creating functions for use with <code>foot</code> follows the same procedures and syntax for functions in <code>R</code> in general. They must be declared with <code>&lt;- function()</code> and they must be available within the environment where <code>foot</code> functions are being used. When the functions are used internally by <code>calculate_footstats</code>, they are applied to footprints by zone index. Therefore they should return a single, summary value since the function for that group of footprints in the zone.</p>
<p>The name of the function is what is passed to <code>foot</code> as an argument to <code>how</code>. The argument(s) to the custom function can be named anything, but they will typically be values present within the footprint attributes to be summarised.</p>
<p>The example below shows a simple function that calculates the sum of the square root of the values. We will apply it to ‘area’, and <code>foot</code> will automatically pre-calculate this characteristic since it is not present in the column names of the footprints.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="co"># simple function example 1</span>
<span class="va">f1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">v</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/difftime.html">units</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co"># ignore units in our function</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># applying custom summary function to area</span>
<span class="fu"><a href="../reference/calculate_footstats.html">calculate_footstats</a></span><span class="op">(</span><span class="va">buildings</span>,
                    <span class="va">adminzones</span>,
                    what<span class="op">=</span><span class="st">"area"</span>, how<span class="op">=</span><span class="st">"f1"</span>,
                    verbose<span class="op">=</span><span class="cn">F</span><span class="op">)</span>
<span class="co">#&gt;     zoneID    area_f1</span>
<span class="co">#&gt;  1:      1  364.18909</span>
<span class="co">#&gt;  2:      2 1823.23957</span>
<span class="co">#&gt;  3:      3  871.63637</span>
<span class="co">#&gt;  4:      4 1966.54994</span>
<span class="co">#&gt;  5:      5  867.92154</span>
<span class="co">#&gt;  6:      6  822.51869</span>
<span class="co">#&gt;  7:      7  485.66087</span>
<span class="co">#&gt;  8:      8 1194.46899</span>
<span class="co">#&gt;  9:      9 3048.19689</span>
<span class="co">#&gt; 10:     10  385.24272</span>
<span class="co">#&gt; 11:     11 1404.13211</span>
<span class="co">#&gt; 12:     12  294.77870</span>
<span class="co">#&gt; 13:     13   73.79837</span>
<span class="co">#&gt; 14:     14  730.25610</span>
<span class="co">#&gt; 15:     15 2014.66636</span>
<span class="co">#&gt; 16:     16 1154.35602</span>
<span class="co">#&gt; 17:     17 1133.49662</span>
<span class="co">#&gt; 18:     18 3472.56857</span>
<span class="co">#&gt; 19:     19 5905.48635</span>
<span class="co">#&gt; 20:     20 5262.66216</span>
<span class="co">#&gt; 21:     21  998.62900</span>
<span class="co">#&gt; 22:     22  722.37587</span>
<span class="co">#&gt; 23:     23 3441.00032</span>
<span class="co">#&gt; 24:     24 3882.17755</span>
<span class="co">#&gt; 25:     25  435.66830</span>
<span class="co">#&gt; 26:     26 3426.43477</span>
<span class="co">#&gt; 27:     27 2283.48433</span>
<span class="co">#&gt; 28:     29 1910.57791</span>
<span class="co">#&gt; 29:     30  989.77450</span>
<span class="co">#&gt; 30:     31   11.92210</span>
<span class="co">#&gt; 31:     32 1913.14204</span>
<span class="co">#&gt; 32:     33  309.58519</span>
<span class="co">#&gt; 33:     34 9839.29584</span>
<span class="co">#&gt;     zoneID    area_f1</span></pre></div>
<p>Although this function was just used to process area, the function can be used for any continuous value. It can also be used on multiple characteristics or combined with other lists of functions, just like any other built-in function in <code>foot</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="fu"><a href="../reference/calculate_footstats.html">calculate_footstats</a></span><span class="op">(</span><span class="va">buildings</span>,
                    <span class="va">adminzones</span>,
                    what<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"area"</span>,<span class="st">"perimeter"</span><span class="op">)</span>, how<span class="op">=</span><span class="st">"f1"</span>,
                    verbose<span class="op">=</span><span class="cn">F</span><span class="op">)</span>
<span class="co">#&gt;     zoneID    area_f1 perimeter_f1</span>
<span class="co">#&gt;  1:      1  364.18909   183.488651</span>
<span class="co">#&gt;  2:      2 1823.23957  1048.879091</span>
<span class="co">#&gt;  3:      3  871.63637   426.068457</span>
<span class="co">#&gt;  4:      4 1966.54994   968.615609</span>
<span class="co">#&gt;  5:      5  867.92154   412.069737</span>
<span class="co">#&gt;  6:      6  822.51869   337.518569</span>
<span class="co">#&gt;  7:      7  485.66087   171.066602</span>
<span class="co">#&gt;  8:      8 1194.46899   515.464525</span>
<span class="co">#&gt;  9:      9 3048.19689  1911.775834</span>
<span class="co">#&gt; 10:     10  385.24272   226.579855</span>
<span class="co">#&gt; 11:     11 1404.13211   857.273283</span>
<span class="co">#&gt; 12:     12  294.77870   214.216882</span>
<span class="co">#&gt; 13:     13   73.79837    35.239420</span>
<span class="co">#&gt; 14:     14  730.25610   500.492421</span>
<span class="co">#&gt; 15:     15 2014.66636  1407.986177</span>
<span class="co">#&gt; 16:     16 1154.35602   835.883724</span>
<span class="co">#&gt; 17:     17 1133.49662   716.240827</span>
<span class="co">#&gt; 18:     18 3472.56857  2477.699320</span>
<span class="co">#&gt; 19:     19 5905.48635  3199.202606</span>
<span class="co">#&gt; 20:     20 5262.66216  2994.324208</span>
<span class="co">#&gt; 21:     21  998.62900   552.056838</span>
<span class="co">#&gt; 22:     22  722.37587   400.124081</span>
<span class="co">#&gt; 23:     23 3441.00032  1548.754569</span>
<span class="co">#&gt; 24:     24 3882.17755  2167.419552</span>
<span class="co">#&gt; 25:     25  435.66830   207.129346</span>
<span class="co">#&gt; 26:     26 3426.43477  1360.146927</span>
<span class="co">#&gt; 27:     27 2283.48433  1300.818322</span>
<span class="co">#&gt; 28:     29 1910.57791  1117.788513</span>
<span class="co">#&gt; 29:     30  989.77450   569.928890</span>
<span class="co">#&gt; 30:     31   11.92210     6.938055</span>
<span class="co">#&gt; 31:     32 1913.14204  1042.133260</span>
<span class="co">#&gt; 32:     33  309.58519   155.175160</span>
<span class="co">#&gt; 33:     34 9839.29584  6005.424628</span>
<span class="co">#&gt;     zoneID    area_f1 perimeter_f1</span></pre></div>
</div>
<div id="functions-with-multiple-arguments" class="section level2">
<h2 class="hasAnchor">
<a href="#functions-with-multiple-arguments" class="anchor"></a>Functions with multiple arguments</h2>
<p>In some instances, a custom function may need to make use of two or more characteristics from within the building footprint datasets. The built-in functions in <code>foot</code> are primarily designed to work with a single value (e.g. area or perimeter).</p>
<p>While it may sometimes be quicker to pre-calculate the combination, it could be advantageous to use a function, particularly in <code>calculate_bigfoot</code> where smaller subsets of a large building footprint dataset are processed. To make sure multiple attributes are supplied to the summary function, the arguments in <code>what</code> should be specified using a special type (<code>fs_varlist</code>). The <code>fs_varlist</code> creates a nested list within the internal processing to keep the argument together. Keep in mind that the arguments are passed to the summary function by <strong>position</strong>, not be name, so the order within <code>fs_varlist</code> must match the order of parameters that the function is expecting.</p>
<div id="creating-a-perimeterarea-ratio" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-a-perimeterarea-ratio" class="anchor"></a>Creating a Perimeter/Area ratio</h3>
<p>An example of a custom function using two characteristics is the average perimeter-area ratio. We can compare this to the built-in function which uses a Polsby-Popper metric (<code>fs_compact</code>).</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="co"># average perimeter-area ratio</span>
<span class="va">pa</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">a</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">p</span> <span class="op">/</span> <span class="va">a</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># used to summarise within zones</span>
<span class="co"># note that fs_varlist is still within a list</span>
<span class="fu"><a href="../reference/calculate_footstats.html">calculate_footstats</a></span><span class="op">(</span><span class="va">buildings</span>,
                    <span class="va">adminzones</span>,
                    what<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"compact"</span><span class="op">)</span>, <span class="fu"><a href="../reference/fs_varlist.html">fs_varlist</a></span><span class="op">(</span><span class="st">"area"</span>,<span class="st">"perimeter"</span><span class="op">)</span><span class="op">)</span>,
                    how<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"mean"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"pa"</span><span class="op">)</span><span class="op">)</span>,
                    verbose<span class="op">=</span><span class="cn">T</span>
                   <span class="op">)</span>
<span class="co">#&gt; Selecting metrics </span>
<span class="co">#&gt; Setting control values. </span>
<span class="co">#&gt; Creating zonal index </span>
<span class="co">#&gt; Pre-calculating areas </span>
<span class="co">#&gt; Pre-calculating perimeters </span>
<span class="co">#&gt; Pre-calculating compactness </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Calculating  2  metrics ... </span>
<span class="co">#&gt;    compact mean  </span>
<span class="co">#&gt;    area perimeter pa  </span>
<span class="co">#&gt; Finished calculating metrics.</span>
<span class="co">#&gt;     zoneID compact_mean area_perimeter_pa</span>
<span class="co">#&gt;  1:      1    0.5991569      3.610827 [m]</span>
<span class="co">#&gt;  2:      2    0.6575220      2.821102 [m]</span>
<span class="co">#&gt;  3:      3    0.6126862      3.640346 [m]</span>
<span class="co">#&gt;  4:      4    0.6272569      3.572513 [m]</span>
<span class="co">#&gt;  5:      5    0.6053632      3.772161 [m]</span>
<span class="co">#&gt;  6:      6    0.6255586      5.090459 [m]</span>
<span class="co">#&gt;  7:      7    0.5447738      6.750857 [m]</span>
<span class="co">#&gt;  8:      8    0.5516914      4.786082 [m]</span>
<span class="co">#&gt;  9:      9    0.6113972      2.338425 [m]</span>
<span class="co">#&gt; 10:     10    0.6219757      2.535005 [m]</span>
<span class="co">#&gt; 11:     11    0.5777758      2.484360 [m]</span>
<span class="co">#&gt; 12:     12    0.6591031      1.771451 [m]</span>
<span class="co">#&gt; 13:     13    0.5629929      3.321843 [m]</span>
<span class="co">#&gt; 14:     14    0.7122782      2.109547 [m]</span>
<span class="co">#&gt; 15:     15    0.7247100      1.988679 [m]</span>
<span class="co">#&gt; 16:     16    0.6982459      1.869702 [m]</span>
<span class="co">#&gt; 17:     17    0.6518730      2.353175 [m]</span>
<span class="co">#&gt; 18:     18    0.6869924      1.842260 [m]</span>
<span class="co">#&gt; 19:     19    0.6686708      3.282259 [m]</span>
<span class="co">#&gt; 20:     20    0.6810544      2.956515 [m]</span>
<span class="co">#&gt; 21:     21    0.6926037      3.095947 [m]</span>
<span class="co">#&gt; 22:     22    0.7113827      3.226212 [m]</span>
<span class="co">#&gt; 23:     23    0.6151105      4.069236 [m]</span>
<span class="co">#&gt; 24:     24    0.6682211      3.074468 [m]</span>
<span class="co">#&gt; 25:     25    0.6304162      4.012065 [m]</span>
<span class="co">#&gt; 26:     26    0.6118970      5.404871 [m]</span>
<span class="co">#&gt; 27:     27    0.6831782      2.964538 [m]</span>
<span class="co">#&gt; 28:     29    0.6616867      2.660880 [m]</span>
<span class="co">#&gt; 29:     30    0.6448110      2.882803 [m]</span>
<span class="co">#&gt; 30:     31    0.7708405      2.952773 [m]</span>
<span class="co">#&gt; 31:     32    0.6358119      3.116430 [m]</span>
<span class="co">#&gt; 32:     33    0.5847305      3.728961 [m]</span>
<span class="co">#&gt; 33:     34    0.6413189      2.529615 [m]</span>
<span class="co">#&gt;     zoneID compact_mean area_perimeter_pa</span></pre></div>
</div>
</div>
<div id="accessing-r-objects-other-than-the-footprints" class="section level2">
<h2 class="hasAnchor">
<a href="#accessing-r-objects-other-than-the-footprints" class="anchor"></a>Accessing <code>R</code> objects other than the footprints</h2>
<p>A more complicated scenario exists when a user-defined function needs to access data which is not an attribute of the footprints dataset. In order to access the non-footprint data, a partial function must be created first and then supplied to calculation function.</p>
<p>In the example below, a simple constant value is supplied to a summary function; however, the idea extends to any object in the <code>R</code> environment. This process is how the nearest neighbour index is calculated in <code>foot</code> by drawing on the spatial zones object as well as the footprints.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="co"># external "data"</span>
<span class="va">d1</span> <span class="op">&lt;-</span> <span class="fl">0.001</span>

<span class="co"># This will NOT work because argument 'd' is not found</span>
<span class="co"># f2 &lt;- function(x, d){</span>
<span class="co">#   return(sum(d * x))</span>
<span class="co"># }</span>
<span class="co"># </span>
<span class="co"># calculate_footstats(buildings, adminzones, what="area", how="f2", verbose=T)</span>

<span class="co"># Instead...</span>
<span class="co"># example of creating a partial function</span>
<span class="va">gen_f3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/force.html">force</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="co"># must include</span>
  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">d</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="co"># generate the function and initialise it with `d1` from above.</span>
<span class="va">f3</span> <span class="op">&lt;-</span> <span class="fu">gen_f3</span><span class="op">(</span><span class="va">d1</span><span class="op">)</span>

<span class="co"># this now uses the generated function, and `d` is found</span>
<span class="fu"><a href="../reference/calculate_footstats.html">calculate_footstats</a></span><span class="op">(</span><span class="va">buildings</span>, 
                    <span class="va">adminzones</span>, 
                    what<span class="op">=</span><span class="st">"area"</span>, 
                    how<span class="op">=</span><span class="st">"f3"</span>, 
                    verbose<span class="op">=</span><span class="cn">F</span>
                   <span class="op">)</span>
<span class="co">#&gt;     zoneID           area_f3</span>
<span class="co">#&gt;  1:      1   8.4545661 [m^2]</span>
<span class="co">#&gt;  2:      2  29.7585314 [m^2]</span>
<span class="co">#&gt;  3:      3  25.7286600 [m^2]</span>
<span class="co">#&gt;  4:      4  63.8357113 [m^2]</span>
<span class="co">#&gt;  5:      5  26.7296259 [m^2]</span>
<span class="co">#&gt;  6:      6  35.7683531 [m^2]</span>
<span class="co">#&gt;  7:      7  28.3878563 [m^2]</span>
<span class="co">#&gt;  8:      8  44.5041537 [m^2]</span>
<span class="co">#&gt;  9:      9  48.1457825 [m^2]</span>
<span class="co">#&gt; 10:     10   7.5599164 [m^2]</span>
<span class="co">#&gt; 11:     11  24.2123780 [m^2]</span>
<span class="co">#&gt; 12:     12   3.1098042 [m^2]</span>
<span class="co">#&gt; 13:     13   2.6464756 [m^2]</span>
<span class="co">#&gt; 14:     14   6.7120641 [m^2]</span>
<span class="co">#&gt; 15:     15  19.2269062 [m^2]</span>
<span class="co">#&gt; 16:     16   9.9002318 [m^2]</span>
<span class="co">#&gt; 17:     17  14.7525754 [m^2]</span>
<span class="co">#&gt; 18:     18  36.8954355 [m^2]</span>
<span class="co">#&gt; 19:     19  96.4900399 [m^2]</span>
<span class="co">#&gt; 20:     20  80.3556287 [m^2]</span>
<span class="co">#&gt; 21:     21  18.0633304 [m^2]</span>
<span class="co">#&gt; 22:     22  10.1969657 [m^2]</span>
<span class="co">#&gt; 23:     23 132.6730618 [m^2]</span>
<span class="co">#&gt; 24:     24  61.8347854 [m^2]</span>
<span class="co">#&gt; 25:     25  11.6430956 [m^2]</span>
<span class="co">#&gt; 26:     26 150.2087190 [m^2]</span>
<span class="co">#&gt; 27:     27  33.8168355 [m^2]</span>
<span class="co">#&gt; 28:     29  37.0078380 [m^2]</span>
<span class="co">#&gt; 29:     30  15.2761021 [m^2]</span>
<span class="co">#&gt; 30:     31   0.1421365 [m^2]</span>
<span class="co">#&gt; 31:     32  35.7328487 [m^2]</span>
<span class="co">#&gt; 32:     33   7.1172864 [m^2]</span>
<span class="co">#&gt; 33:     34 146.9351905 [m^2]</span>
<span class="co">#&gt;     zoneID           area_f3</span></pre></div>
<p>In this vignette, the <code>foot</code> package has been extended to incorporate user-defined functions. These functions can use one or more values from within the footprints, or even access other objects in the environment. While the examples used <code>calculate_footstats</code>, the same approaches can be used to create new gridded summary metrics with <code>calculate_bigfoot</code>.</p>
<hr>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; R version 3.6.3 (2020-02-29)</span>
<span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span>
<span class="co">#&gt; Running under: Ubuntu 20.04.1 LTS</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0</span>
<span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt;  [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C               LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8     LC_MONETARY=en_GB.UTF-8    LC_MESSAGES=en_GB.UTF-8    LC_PAPER=en_GB.UTF-8      </span>
<span class="co">#&gt;  [8] LC_NAME=C                  LC_ADDRESS=C               LC_TELEPHONE=C             LC_MEASUREMENT=en_GB.UTF-8 LC_IDENTIFICATION=C       </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt; [1] stars_0.4-1  abind_1.4-5  foot_0.5     knitr_1.28   sf_0.9-2     raster_3.1-5 sp_1.4-1    </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] pkgload_1.0.2      foreach_1.4.8      StanHeaders_2.19.2 assertthat_0.2.1   highr_0.8          stats4_3.6.3       yaml_2.2.1         remotes_2.1.1      sessioninfo_1.1.1  pillar_1.4.3      </span>
<span class="co">#&gt; [11] backports_1.1.5    lattice_0.20-40    glue_1.4.0         digest_0.6.25      colorspace_1.4-1   htmltools_0.4.0    pkgconfig_2.0.3    devtools_2.3.0     rstan_2.19.3       purrr_0.3.3       </span>
<span class="co">#&gt; [21] scales_1.1.0       processx_3.4.2     whisker_0.4        downlit_0.2.0      tibble_3.0.1       ggplot2_3.3.0      usethis_1.6.1      ellipsis_0.3.0     withr_2.1.2        cli_2.0.2         </span>
<span class="co">#&gt; [31] magrittr_1.5       crayon_1.3.4       memoise_1.1.0      evaluate_0.14      ps_1.3.2           fs_1.3.1           fansi_0.4.1        doParallel_1.0.15  xml2_1.3.1         lwgeom_0.2-3      </span>
<span class="co">#&gt; [41] class_7.3-16       pkgbuild_1.0.6     loo_2.2.0          tools_3.6.3        data.table_1.12.8  prettyunits_1.1.1  matrixStats_0.56.0 formatR_1.7        lifecycle_0.2.0    stringr_1.4.0     </span>
<span class="co">#&gt; [51] munsell_0.5.0      callr_3.4.3        packrat_0.5.0      compiler_3.6.3     pkgdown_1.6.1      e1071_1.7-3        rlang_0.4.5        classInt_0.4-3     units_0.6-6        grid_3.6.3        </span>
<span class="co">#&gt; [61] iterators_1.0.12   rstudioapi_0.11    rmarkdown_2.1      testthat_2.3.2     gtable_0.3.0       codetools_0.2-16   inline_0.3.15      DBI_1.1.0          rematch2_2.1.1     R6_2.4.1          </span>
<span class="co">#&gt; [71] gridExtra_2.3      dplyr_0.8.5        rgdal_1.4-8        filelock_1.0.2     rprojroot_1.3-2    KernSmooth_2.23-16 desc_1.2.0         stringi_1.4.6      parallel_3.6.3     Rcpp_1.0.4.6      </span>
<span class="co">#&gt; [81] vctrs_0.2.4        tidyselect_1.0.0   xfun_0.12</span></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by WorldPop Research Group, University of Southampton, Chris Jochem.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
